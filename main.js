"use strict";var t=require("obsidian");function e(t,e,i,n){return new(i||(i=Promise))(function(s,o){function a(t){try{d(n.next(t))}catch(t){o(t)}}function r(t){try{d(n.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,r)}d((n=n.apply(t,e||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const i="remotion-preview-view";class n extends t.ItemView{constructor(t){super(t),this.iframe=null,this.icon="video"}getViewType(){return i}getDisplayText(){return"Remotion Preview"}onOpen(){return e(this,void 0,void 0,function*(){const t=this.containerEl.children[1];t.empty(),t.addClass("remotion-preview-container"),this.iframe=t.createEl("iframe",{cls:"remotion-preview-iframe"}),this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.border="none",this.iframe.style.backgroundColor="#000",this.iframe.srcdoc="\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset=\"utf-8\">\n                <style>\n                    body { \n                        margin: 0; \n                        padding: 20px;\n                        font-family: system-ui;\n                        background: #1a1a1a;\n                        color: #fff;\n                    }\n                    pre {\n                        white-space: pre-wrap;\n                        word-break: break-word;\n                        background: #111;\n                        padding: 12px;\n                        border-radius: 6px;\n                        border: 1px solid #333;\n                    }\n                </style>\n            </head>\n            <body>\n                <h2>Remotion Preview</h2>\n                <p>Preview panel initialized. Awaiting extraction output...</p>\n                <pre id=\"extract-output\">No data yet</pre>\n                <script>\n                    window.addEventListener('message', (event) => {\n                        const data = event.data;\n                        if (!data || data.type !== 'extract-code-blocks') return;\n                        const pre = document.getElementById('extract-output');\n                        pre.textContent = JSON.stringify(data.payload, null, 2);\n                    });\n                <\/script>\n            </body>\n            </html>\n        "})}onClose(){return e(this,void 0,void 0,function*(){this.iframe=null})}updateExtractedBlocks(t){var e;(null===(e=this.iframe)||void 0===e?void 0:e.contentWindow)&&this.iframe.contentWindow.postMessage({type:"extract-code-blocks",payload:t},"*")}}const s={defaultFps:30,defaultWidth:1920,defaultHeight:1080};class o extends t.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){const{containerEl:i}=this;i.empty(),i.createEl("h2",{text:"Remotion Preview Settings"}),new t.Setting(i).setName("Default FPS").setDesc("Default frames per second for Remotion compositions.").addText(t=>t.setValue(String(this.plugin.settings.defaultFps)).onChange(t=>e(this,void 0,void 0,function*(){const e=parseInt(t);!isNaN(e)&&e>0&&(this.plugin.settings.defaultFps=e,yield this.plugin.saveSettings())}))),new t.Setting(i).setName("Default Width").setDesc("Default composition width in pixels.").addText(t=>t.setValue(String(this.plugin.settings.defaultWidth)).onChange(t=>e(this,void 0,void 0,function*(){const e=parseInt(t);!isNaN(e)&&e>0&&(this.plugin.settings.defaultWidth=e,yield this.plugin.saveSettings())}))),new t.Setting(i).setName("Default Height").setDesc("Default composition height in pixels.").addText(t=>t.setValue(String(this.plugin.settings.defaultHeight)).onChange(t=>e(this,void 0,void 0,function*(){const e=parseInt(t);!isNaN(e)&&e>0&&(this.plugin.settings.defaultHeight=e,yield this.plugin.saveSettings())})))}}class a extends t.Plugin{onload(){return e(this,void 0,void 0,function*(){yield this.loadSettings(),this.registerView(i,t=>new n(t)),this.addRibbonIcon("video","Toggle Remotion Preview",()=>e(this,void 0,void 0,function*(){yield this.toggleView()})),this.addSettingTab(new o(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.onActiveLeafChange()})),this.onActiveLeafChange(),console.log("Remotion plugin loaded")})}loadSettings(){return e(this,void 0,void 0,function*(){this.settings=Object.assign({},s,yield this.loadData())})}saveSettings(){return e(this,void 0,void 0,function*(){yield this.saveData(this.settings)})}onActiveLeafChange(){return e(this,void 0,void 0,function*(){const e=this.app.workspace.getActiveViewOfType(t.MarkdownView);if(e){yield this.activateView();const t=this.getPreviewView();if(t){const i=function(t){const e=[],i=t.split("\n");let n=0,s=0;for(;n<i.length;){const t=i[n],o=t.trim();if((o.startsWith("```")||o.startsWith("~~~"))&&o.length>=3){const a=(o.startsWith("```")?"```":"~~~")[0],r=o.slice(3).match(/^\w+/),d=r?r[0]:"";if(["ts","tsx","typescript"].includes(d)){const o=n,r=s;let c="";for(n++,s+=t.length+1;n<i.length;){const t=i[n],l=t.trim();if(l.startsWith(a)&&l.length>=3){const i=s,a=n;e.push({content:c.trimEnd(),language:d,startLine:o,endLine:a,startOffset:r,endOffset:i}),s+=t.length+1,n++;break}c+=t+"\n",s+=t.length+1,n++}}else s+=t.length+1,n++}else s+=t.length+1,n++}return e}(e.editor.getValue());t.updateExtractedBlocks(i)}}})}toggleView(){return e(this,void 0,void 0,function*(){this.app.workspace.getLeavesOfType(i)[0]?this.app.workspace.detachLeavesOfType(i):yield this.activateView()})}activateView(){return e(this,void 0,void 0,function*(){const t=this.app.workspace.getLeavesOfType(i)[0];if(t)return void this.app.workspace.revealLeaf(t);const e=this.app.workspace.getRightLeaf(!1);e&&(yield e.setViewState({type:i,active:!1}),this.app.workspace.revealLeaf(e))})}getPreviewView(){const t=this.app.workspace.getLeavesOfType(i)[0];return(null==t?void 0:t.view)instanceof n?t.view:null}onunload(){return e(this,void 0,void 0,function*(){this.app.workspace.detachLeavesOfType(i)})}}module.exports=a;
//# sourceMappingURL=main.js.map
